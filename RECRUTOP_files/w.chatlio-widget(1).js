!function(){"use strict";var e,t="a21f0ae-1461098743097",s={},a=["https://w.chatlio.com/v3/vendor/chatlio-react-0.14.7-with-addons.min.f45b6108.js"];(!window.Pusher||window.Pusher.VERSION<"2.1.0")&&a.push("https://w.chatlio.com/v3/vendor/pusher-3.0.min.5f442757.js");var i,n,o=window.localStorage,r=function(){try{var e=Date.now();return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return console.warn("localStorage is not available"),!1}};r()||(o={_data:{},setItem:function(e,t){this._data[e]=JSON.stringify(t)},getItem:function(e){return this._data.hasOwnProperty(e)?this._data[e]:null}});var l,c,h,m,d,u,p,f,g,w,v,y,b,S,E,C,N="function"==typeof window.html2canvas,I=!1,T="https://w.chatlio.com/v3/main.83622947.css",q="https://w.chatlio.com/v3/sidebar.1151ed33.css",x=2e4,O=9e4,R=!0,A=!1,M=200,k=5,L=new Audio("https://w.chatlio.com/v3/media/water-drips-single16.7cb55185.mp3");L.volume=.8;var U,_="onpropertychange"in document&&!window.matchMedia,D={userId:void 0,traits:{}},P={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},F=/[&><"']/g,V=function(e){return P[e]},j=function(e){return e&&e.length>0?e.replace(F,V):""},B=function(e,t){var s=document.createEvent("Event");t&&(s.data=t),s.initEvent("chatlio."+e,!0,!0),y.dispatchEvent(s)},W=function(e){var t=document.createElement("div");t.id="chatlio-widget";var s=document.getElementById("chatlioWidgetPlaceholder");if(s?document.getElementById("chatlioWidgetPlaceholder").appendChild(t):document.body.appendChild(t),l=j(e.getAttribute("data-widget-id")),!l)return console.warn("Missing widget UUID. Did you set the 'data-widget-id' attribute?"),!1;h="chatlio_uuid--"+j(l),f=j(e.getAttribute("data-start-hidden"))||!1,"false"!==f&&"null"!==f||(f=!1),T=j(e.getAttribute("data-chatlio-css-src"))||T;try{m=JSON.parse(e.getAttribute("data-widget-options"))||{}}catch(a){m={}}return d=JSON.parse(e.getAttribute("data-widget-metadata")),t},J=function(){for(var e="w.chatlio-widget.js",t=document.getElementsByTagName("script"),s=0;s<t.length;s++){var a=t[s].src;if(a&&a.indexOf(e)>=0)return t[s]}return null},H={"just now":"just now","y ago":"y ago","mo ago":"m ago","d ago":"d ago","h ago":"h ago","m ago":"m ago"},Y=function(e){if(isNaN(e))return"";var t,s=Math.floor((new Date-e)/1e3),a="";return 60>s?H["just now"]:(a=(t=Math.floor(s/31536e3))>1?H["y ago"]:(t=Math.floor(s/2592e3))>1?H["mo ago"]:(t=Math.floor(s/86400))>1?H["d ago"]:(t=Math.floor(s/3600))>1?H["h ago"]:(t=Math.floor(s/60))>=1?H["m ago"]:"",t+a)},K=function(e,t){var s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",e),s.onload=t,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(s)},z=function(e){return e&&"object"==typeof e&&"createElement"in e&&e.version>="0.14.3"&&"__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED"in e},$=function(e){var t=e.split(".");return t.length<=2?e:t.slice(1).join(".")},G=function(){var e=h+"=;path=/;domain="+$(window.location.hostname)+";expires=Thu, 01 Jan 1970 00:00:01 GMT;";document.cookie=e},X=function(e){for(var t=e+"=",s=document.cookie.split(";"),a=0;a<s.length;a++){var i=s[a];if(-1!==i.indexOf(t)){for(;" "===i.charAt(0);)i=i.substring(1);var n=i.substring(t.length,i.length);return o.setItem(e,n),n}}return""};"undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues?U=window.crypto:"undefined"!=typeof window&&"object"==typeof window.msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&(U=window.msCrypto);var Q=function(){var e=new Uint16Array(8);U.getRandomValues(e);var t=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return t(e[0])+t(e[1])+"-"+t(e[2])+"-"+t(e[3])+"-"+t(e[4])+"-"+t(e[5])+t(e[6])+t(e[7])},Z=function(){var e=Date.now(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:3&s|8).toString(16)});return t},ee=U?Q:Z,te=function(e){var t=o.getItem(h)||X(h);""===t&&(t=e||ee(),o.setItem(h,t));var s=h+"="+t+";path=/;domain="+$(window.location.hostname);return document.cookie=s,t},se=function(e){g="chatlio-"+e+"-messages",w="chatlio-"+e+"-isClosed",v="chatlio-"+e+"-provided-req-info"},ae=function(e){return e=e||{},clearTimeout(C),o.removeItem(h),G(),c=te(e.vsUuid),o.removeItem(w),o.removeItem(v),o.removeItem(g),se(c),D={userId:void 0,traits:{}},e.messages&&e.messages.length>0&&Array.isArray(e.messages)&&o.setItem(g,JSON.stringify(e.messages)),void 0!==e.isClosed?o.setItem(w,e.isClosed):o.setItem(w,"true"),e.reqInfo&&o.setItem(v,e.reqInfo),b&&b.disconnect&&b.disconnect(),b=void 0,!0},ie=function(){return"undefined"!=typeof window.define&&"undefined"!=typeof window.require},ne=function(e,t){var s=new XMLHttpRequest;if("undefined"!=typeof XDomainRequest)s=new XDomainRequest;else if(!("withCredentials"in s))throw new Error("Your browser does not support CORS. Please contact chatlio support at support@chatlio.com");return t&&""!==t||(t="GET"),s.open(t,e,!0),s},oe=function(e,t){t=t||{};var s;if("POST"===t.verb)s=ne(e,t.verb);else if(null!==t.data){var a=t.data||"vsUuid="+c+"&ceUuid="+l;s=ne(e+"?"+a)}else s=ne(e);if(s.onload=function(){if("withCredentials"in s)200===s.status?t.success&&t.success.apply(s,arguments):s.status>=400&&s.status<500?t.error&&t.error.apply(s,arguments):t.failure&&t.failure.apply(s,arguments);else{var e;try{e=JSON.parse(this.responseText)||{}}catch(a){e={}}var i;e.status&&(i=parseInt(e.status)),!e.status||"200"!==e.status&&"online"!==e.status?t.error&&e.status&&i>=400&&500>i?t.error.apply(s,arguments):t.failure&&t.failure.apply(s,arguments):t.success&&t.success.apply(s,arguments)}},s.onerror=function(){t.failure&&t.failure.apply(s,arguments)},t.timeout>0&&(s.timeout=t.timeout,t.ontimeout?s.ontimeout=function(){t.ontimeout.apply(s,arguments)}:s.ontimeout=function(){t.failure&&t.failure.apply(s,arguments)}),"POST"===t.verb){var i=JSON.stringify(t.data);s.send(i)}else s.send();return s},re=function(){var e=o.getItem(g),t=JSON.parse(e)||[];return t},le=5,ce=2,he=function(){n=i.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;var e="vsUuid="+c+"&ceUuid="+l+"&currentPage="+encodeURIComponent(window.location.href);document.referrer&&document.referrer.length>0&&location.host.length>0&&location.host!==document.referrer.split("/")[2]&&(e+=e+"&referrerURL="+encodeURIComponent(document.referrer.substring(0,240))),oe("https://api.chatlio.com/v1/p/visitor/new",{data:e,timeout:2999,success:function(){I=!0,ke(this.responseText),B("ready")},error:function(){409===this.status&&ce>0&&(ce--,ae({isClosed:o.getItem(w),reqInfo:o.getItem(v),messages:re()}),he())},failure:function(){le>0?(le--,setTimeout(he,5003)):console.error("Oh noes! There was a problem registering the Chatlio widget '"+c+"'/'"+l+"'. Please contact Chatlio support! Status code: ",this.status)}})},me=function(){if(m.forceRequireLoad){var e=0,t=function(){ie()?require(a,function(e){if(z(e))i=e;else{if(!z(window.ChatlioReact))return void console.warn("Forced require() loading React failed. Contact Chatlio support: support@chatlio.com");i=window.ChatlioReact}he()}):10>e?(e++,setTimeout(t,500)):console.warn("Waiting for require() to appear. Contact Chatlio support: support@chatlio.com")};t()}else if(ie()&&m.skipRequireLoad!==!0)require(a,function(e){if(z(e))i=e;else{if(!z(window.ChatlioReact))return void console.warn("require() loading React failed. Contact Chatlio support: support@chatlio.com");i=window.ChatlioReact}he()});else{var s=0,n=function(){if(s++,s===a.length){if(!z(window.ChatlioReact))return void console.warn("Loading React failed. Contact Chatlio support: support@chatlio.com");i=window.ChatlioReact,he()}};a.forEach(function(e){K(e,n)})}},de=function(e){var t=document.createElement("link");t.setAttribute("type","text/css"),t.setAttribute("rel","stylesheet"),t.setAttribute("href",j(e)),(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(t)},ue=function(e){var t=e||re();return 0!==t.length},pe=function(e,t){return e?1e3*e.ts>Date.now()-60*t*1e3:!1},fe=function(e,t){var s;return function(){var a=this,i=arguments,n=t&&!s;clearTimeout(s),s=setTimeout(function(){s=null,t||e.apply(a,i)},1500),n&&e.apply(a,i)}},ge=function(e){var t=o.getItem(w);return e&&A?!1:t&&"undefined"!==t?!JSON.parse(t):!1},we=function(e){if(!e||""===e)return!1;for(var t=e.split(/[\s,]/).filter(function(e){return e.replace(/\s/,"")}),s=window.location.href,a=0;a<t.length;a++){var i,n=t[a];try{i=new RegExp(n)}catch(o){console.warn("'%s' is not a valid regular expression",n);continue}if(s.match(i))return!0}return!1},ve=fe(function(){oe("https://api.chatlio.com/v1/p/visitor/"+c+"/typing",{data:null})},!0),ye=function(e){oe("https://api.chatlio.com/v1/p/visitor/message/ack/"+e)},be=function(){console.warn("Called render before initialization")},Se=function(){if(p=!1,B("offline"),s.isShown()&&E){var e=JSON.parse(E);e.connecting=!0,e.expanded=ge(),be(e),E=JSON.stringify(e)}},Ee=function(){var e={authEndpoint:"https://api.chatlio.com/v1/p/visitor/auth",encrypted:!0,authTransport:_?"jsonp":"ajax",disableStats:!0};b=new Pusher("7fc2084f5bc6a21f2dfe",e),b.connection.bind("failed",function(){console.error("No native WebSockets and no working fallback (Flash, http)")}),b.connection.bind("unavailable",function(){console.warn("Connection unavailable. Reconnecting in 10 seconds."),Se()}),b.connection.bind("disconnected",function(){console.log("Disconnected."),Se()})},Ce=function(e,t,s,a,i){if(void 0===b){Ee();var n=b.subscribe("private-"+c);n.bind("new_message",function(t){u||_chatlio.show({expanded:!0}),ye(t.ts),e(t),B("messageReceived",t)}),n.bind("user_typing",t),n.bind("service_messages",function(e){switch(e.type){case"screenshot":if(!N){var t="https://w.chatlio.com/v3/vendor/html2canvas-0.4.1.min.5330312b.js";K(t,function(){N="function"==typeof window.html2canvas})}s(e);break;case"request-info":a(e);break;case"no-answer":i(e);break;default:console.warn("Unhandled service message type: %s",e.type)}});var o=b.subscribe("presence-"+c);o.bind("pusher:subscription_succeeded",function(){}),S=b.subscribe("private-service_messages")}},Ne=function(e,t){var s={ceUuid:l,vsUuid:c,fromVisitor:c,currentPage:window.location.href,message:e,isOfflineMsg:!!t};oe("https://api.chatlio.com/v1/p/visitor/message/new",{verb:"POST",data:s,failure:function(){console.warn("There was a problem sending the message to Chatlio. Please contact Chatlio support at support@chatlio.com. Status code: ",this.status)}})},Ie=function(e,t){if(""===e)return void console.warn("No metadata");if(t||E!==e){var s=JSON.parse(e);if(d){for(var a in d)s[a]=d[a];e=JSON.stringify(s)}var i=p;p=!0;var n=re(),o=n[n.length-1],r=Number(s.maxVisitorInactiveMins)||0;"busy"===s.status&&(r=Math.max(r,k)),!s.off&&"offline"!==s.status||pe(o,r)||(p=!1),i!==p&&B(p?"online":"offline"),u&&!we(s.blacklistedUrls)&&(s.expanded=ge(t),be(s)),E=e}},Te=5;s={version:function(){return{widget:t,loader:e}},vsUuid:function(){return c},messages:function(){return re()},reset:function(e){e=e||{},e.chatlioScriptTagId=e.chatlioScriptTagId||"chatlio-widget-embed";var t=document.getElementById(e.chatlioScriptTagId);return t?(ae(e),y.parentNode.removeChild(y),this.init(t),this):(console.warn("No script node with ID %s",e.chatlioScriptTagId),this)},identify:function(){var e,t={};if(Array.isArray(arguments[0])?"object"==typeof arguments[0][0]?(e=arguments[0][0][0],t=arguments[0][0][1]||{}):(e=arguments[0][0],t=arguments[0][1]||{}):(e=arguments[0],t=arguments[1]||{}),Object.keys(t).forEach(function(e){t[e]=String(t[e])}),D={userId:e,traits:t},D.traits.email&&(o.setItem(v,!0),u&&E)){var s=JSON.parse(E);!s.requireInfo&&p||(s.expanded=ge(),be(s))}return oe("https://api.chatlio.com/v1/p/visitor/identify",{data:"vsUuid="+c+"&ceUuid="+l+"&userId="+encodeURIComponent(e)+"&traits="+encodeURIComponent(JSON.stringify(t)),failure:function(){Te>0?(setTimeout(function(){window._chatlio.identify(e,t)},x),Te--):console.warn("Oh noes! There was a problem identifying the current user to Chatlio. Please contact Chatlio support at support@chatlio.com. Status code: ",this.status)}}),this},track:function(){return this},isShown:function(){return u},isOnline:function(){return p},show:function(e){if(e=e||{},e.hasOwnProperty("expanded")&&(B("mounted"),e.expanded===!0?o.setItem(w,"false"):e.expanded===!1&&o.setItem(w,"true")),u=!0,y.style.display="block",E){var t=JSON.parse(E);t.expanded=ge(),be(t)}return this},hide:function(){return u=!1,y.style.display="none",this},init:function(e){return y=W(e),y&&(E=null,he()),this},configure:function(e){return e?(Array.isArray(e)&&e[0]&&"object"==typeof e[0][0]?d=e[0][0]:(d=e,e.hasOwnProperty("timeLocale")&&(H=e.timeLocale,delete e.timeSinceStrings)),Ie(E,!0),this):(console.warn("_chatlio.configure called without data"),this)},send:function(e){Array.isArray(e)&&(e=e&&e[0]&&e[0][0]);var t=y.getElementsByTagName("TEXTAREA");if(!t||!t[0])return void console.log("[_chatlio.send] Can't send: no widget?");t=t[0],t.value=e;var s=new KeyboardEvent("keydown",{keyCode:13,bubbles:!0,cancelable:!0,detail:740});t.dispatchEvent(s)}};var qe=function(){clearTimeout(C),O>x&&(x+=1e3),C=setTimeout(qe,x),R&&oe("https://api-cdn.chatlio.com/v1/p/chat_endpoints/"+l,{data:null,failure:function(){p&&Se()},success:function(){I&&Ie(this.responseText)}})},xe=function(){if(!window._chatlio)return void console.warn("No _chatlio object on root");var e;try{e=JSON.parse(JSON.stringify(window._chatlio))}catch(t){return void console.warn("Invalid API call: ",t)}window._chatlio=s,e&&e.length>0&&e.forEach(function(e){e.constructor!==Array&&console.warn("invalid chatlio api call: %o",e);var t=e.shift();s[t]||console.warn("unknown chatlio api call: '%s'",String(t)),s[t].call(s,e)})},Oe=function(){oe("https://api.chatlio.com/v1/p/announce/"+l+"/"+c+"/"+e+"/"+t,{verb:"HEAD",data:null})},Re=function(){if("matchMedia"in window){var e=window.matchMedia("(max-width:480px)"),t=function(e){A=!!e.matches};e.addListener(t),t(e)}},Ae="currentScript"in document?document.currentScript:J();y=W(Ae),e=Ae.getAttribute("data-loader-version"),c=te(),se(c),me(),de(T),m.embedSidebar&&de(q),K("https://w.chatlio.com/v3/vendor/emojione-1.4.1.min.2f0e13b4.js"),Re(),Oe();var Me=5,ke=function(e){i&&"createElement"in i||Me>0&&(Me--,console.warn("Chatlios React is not ready yet. Retrying."),setTimeout(ke,500)),document.addEventListener("visibilitychange",function(){document.hidden?R=!1:(R=!0,qe())});var t=function(e){if(!window.emojione||0===e.length)return e;window.emojione.ascii=!0,e=window.emojione.shortnameToImage(e.replace(/:simple_smile:/gim,":grinning:"));for(var t,s=e,a=/<img.*?src="([^">]*\/([^">]*?))".*?>/g,i=/<img.*?.*?>/;t=a.exec(e);){var n=t[1],o="";n=n.substr(n.lastIndexOf("/")+1).split(".")[0];for(var r in window.emojione.emojioneList)if(-1!==window.emojione.emojioneList[r].indexOf(n.toLowerCase())){o=r;break}s=s.replace(i,o)}return s},s=i.addons.CSSTransitionGroup,a="https://w.chatlio.com/v3/images/agent.fa45c4ec.png",r=i.createClass({displayName:"WidgetContainer",getInitialState:function(){var e=re();return ue(e)&&Ce(this.onMessage,this.onTyping,this.onRequestScreenshot,this.onRequestInfo,this.onNewEvent),{uuid:c,messages:e,isFirstMsg:!0,widgetClosed:!this.props.meta.expanded,userTyping:!1,requestScreenshot:!1,requestInfo:!1}},componentWillReceiveProps:function(e){this.setState({widgetClosed:!e.meta.expanded})},widgetViewState:function(){return m.embedInline?"":this.state.widgetClosed?"closed":""},toggleWidget:function(e){o.setItem(w,JSON.stringify(!this.state.widgetClosed)),this.setState({widgetClosed:!this.state.widgetClosed}),e.stopPropagation(),this.state.widgetClosed||B("collapsed")},parseBody:function(e){return""===e||"undefined"==typeof e?e:t(e).replace(/(&lt;|<)(#C|@U|!).*?(&gt;|>)/gm,"").replace(/<(.*?)>/gm,function(e,t){var s=t.split("|"),a='<a target="_blank" href="'+s[0]+'">'+(s[1]||s[0])+"</a>";return a}).replace(/(```([^`]*)```)/gm,"<pre>$2</pre>").replace(/(`([^`]*)`)/gm,"<code>$2</code>")},componentDidMount:function(){B("mounted")},saveToLS:function(){o.setItem(w,JSON.stringify(this.state.widgetClosed)),o.setItem(g,JSON.stringify(this.state.messages.slice(-M)))},sendMessage:function(e){if(13===e.keyCode||void 0===e.keyCode||740===e.detail){if(e.shiftKey)return!0;e.preventDefault();var s="TEXTAREA"===e.target.nodeName?e.target:e.target.parentNode.parentNode.firstChild;s.rows=1;var a=s.value.trim();if(""===a)return!1;var i={body:this.parseBody(j(a)),author:"You",ts:(Date.now()/1e3).toString()};this.state.isFirstMsg&&(this.setState({isFirstMsg:!1}),Ce(this.onMessage,this.onTyping,this.onRequestScreenshot,this.onRequestInfo,this.handleNoAnswer),0===this.state.messages.length&&B("firstMessageSent",i)),s.value="",Ne(t(a).replace(/<(.*?)\|(.*?)>/gm,"$1 $2").replace(/<!(here|channel)>/gm,"@$1")),this.state.messages.push(i),this.setState({messages:this.state.messages}),this.saveToLS()}else(32===e.keyCode||e.keyCode>46&&e.keyCode<91||e.keyCode>95&&e.keyCode<112||e.keyCode>185&&e.keyCode<223)&&ve()},onMessage:function(e){for(var t=this.state.messages.length-1,s=Math.max(0,t-5);t>=s;--t)if(this.state.messages[t].ts===e.ts){if(!e.isEdited)return;return this.state.messages[t].body=this.parseBody(e.body),this.setState({widgetClosed:!1,userTyping:!1,messages:this.state.messages}),void this.saveToLS()}L.play(),e.body=this.parseBody(e.body),this.setState({widgetClosed:!1,userTyping:!1,showOfflineForm:!1,messages:this.state.messages.concat(e)}),this.saveToLS()},isTypingTimeout:0,onTyping:function(e){clearTimeout(this.isTypingTimeout),this.setState({userTyping:e});var t=this;this.isTypingTimeout=setTimeout(function(){t.setState({userTyping:!1})},6e3)},onRequestScreenshot:function(){clearTimeout(this.isTypingTimeout),this.setState({userTyping:!1,requestScreenshot:{dismiss:this.onDismissScreenshot,send:this.onSendScreenshot}}),L.play()},handleNoAnswer:function(e){this.props.meta[e.key]&&(e.data=j(this.props.meta[e.key])),this.state.messages.push({body:e.data,author:"Them",ts:(Date.now()/1e3).toString()}),this.setState({messages:this.state.messages,requestInfo:!1}),this.saveToLS(),L.play()},onShowOfflineForm:function(){this.setState({showingOfflineForm:!0})},onSendScreenshot:function(){if(S.trigger("client-screenshot-sending",{ceUuid:l,vsUuid:c}),"function"!=typeof window.html2canvas)return void console.warn("Screenshot library is not ready yet. Try again in a short while.");var e=this,t={onrendered:function(t){e.setState({requestScreenshot:!1}),oe("https://api.chatlio.com/v1/p/visitor/screenshot",{verb:"POST",data:{image:t.toDataURL("image/png"),vsUuid:c,ceUuid:l},success:function(){e.state.messages.push({body:e.parseBody("✅"),author:"You",ts:(Date.now()/1e3).toString()}),e.setState({messages:e.state.messages})},onerror:function(){console.warn("There was a problem sending your screenshot to Chatlio. Please contact Chatlio support at support@chatlio.com. Status code: ",this.status)}})}};0===window.pageYOffset&&(t.width=window.innerWidth,t.height=window.innerHeight),window.html2canvas(document.body,t)},onDismissScreenshot:function(){S.trigger("client-screenshot-declined",{ceUuid:l,vsUuid:c}),this.setState({requestScreenshot:!1})},onRequestInfo:function(e){clearTimeout(this.isTypingTimeout);var t=e.data.split("|");this.state.requestInfo={dismiss:this.onDismissRequestInfo,send:this.onSendRequestInfo,fields:t},this.state.userTyping=!1,this.setState(this.state),L.play()},onDismissRequestInfo:function(){S.trigger("client-request-info-declined",{ceUuid:l,vsUuid:c}),this.setState({requestInfo:!1})},onSendRequestInfo:function(e){S.trigger("client-request-info-sending",{ceUuid:l,vsUuid:c,payload:e}),this.state.messages.push({body:this.parseBody("✅"),author:"You",ts:(Date.now()/1e3).toString()}),this.setState({messages:this.state.messages,requestInfo:!1})},render:function(){return i.createElement(h,{meta:this.props.meta,requireInfo:this.props.meta.requireInfo,messages:this.state.messages,toggleWidget:this.toggleWidget,widgetViewState:this.widgetViewState(),sendMessage:this.sendMessage,userTyping:this.state.userTyping,requestScreenshot:this.state.requestScreenshot,onShowOfflineForm:this.onShowOfflineForm,showingOfflineForm:this.state.showingOfflineForm,requestInfo:this.state.requestInfo})}}),h=i.createClass({displayName:"WidgetChrome",isOffline:function(){if(this.props.showingOfflineForm)return!0;var e=Number(this.props.meta.maxVisitorInactiveMins);return"busy"===this.props.meta.status?(e=Math.max(e,k),!pe(this.props.messages[this.props.messages.length-1],e)):pe(this.props.messages[this.props.messages.length-1],e)?!1:!(!this.props.meta.off&&"offline"!==this.props.meta.status)},showAvatar:function(){return!1},abortRender:function(){return this.props.meta?!(!this.isOffline()||!this.props.meta.hideWhenOffline):!0},toggleWidget:function(e){this.refs.closeControl.contains(e.target)&&B("closed"),this.props.toggleWidget(e)},render:function(){if(this.abortRender())return null;var e=this.isOffline(),t={backgroundColor:this.props.meta.titleColor},a={color:this.props.meta.titleFontColor},n="chatlio-widget "+this.props.widgetViewState;if(e===!0&&(n+=" offline"),m.embedInline===!0){n+=" embed-inline";var o=document.getElementById("chatlio-widget");o.className=o.className+" embed-inline-container"}var r,l=e?this.props.meta.offlineTitle:this.props.meta.onlineTitle,c=e?this.props.meta.offlineTitle:this.props.meta.agentLabel;if(this.props.meta.forwardSlackUserName&&!this.isOffline()){var h="";if(this.props.meta.showAvatarPreChat&&this.props.meta.activeAgentAvatar&&(h=this.props.meta.activeAgentAvatar),this.props.messages.length>=1&&new Date(1e3*this.props.messages[this.props.messages.length-1].ts)>Date.now()-9e5)for(var u=this.props.messages.length;u--;){"You"!==this.props.messages[u].author&&"Them"!==this.props.messages[u].author&&(c=this.props.messages[u].author);var p=this.props.messages[u].avatarUrl;if(p&&p.length>1){h=this.props.messages[u].avatarUrl;break}}h.length>1&&(r=i.createElement("div",{className:"chatlio-title-avatar-container"},i.createElement("img",{src:h})))}return i.createElement("div",{className:n},i.createElement(s,{transitionName:"flag-slide-out",transitionAppear:"closed"===this.props.widgetViewState,transitionEnterTimeout:5e3,transitionLeaveTimeout:5e3,transitionAppearTimeout:5e3},i.createElement("div",{className:"chatlio-title-bar",style:t,onClick:this.toggleWidget},i.createElement("span",{className:"chatlio-icon-chevron-up chatlio-up-arrow "+this.props.widgetViewState,style:a}),i.createElement("span",{className:"chatlio-title-text"},i.createElement("a",{style:a,onClick:this.toggleWidget},"closed"===this.props.widgetViewState?l:c,r,i.createElement("span",{className:e?"chatlio-online-dot chatlio-hide":"chatlio-online-dot"},"●"))),i.createElement("div",{ref:"closeControl",className:"chatlio-controls-close "+this.props.widgetViewState,style:a},i.createElement("span",{className:"chatlio-icon-minus "+this.props.widgetViewState}),i.createElement("span",{className:"chatlio-icon-cross2"+this.props.widgetViewState})),i.createElement("div",{className:"chatlio-widget-menu-items chatlio-hide"},i.createElement("table",{className:"chatlio-widget-menu-items-table"},i.createElement("tbody",null,i.createElement("tr",{className:"chatlio-widget-menu-icons"},i.createElement("td",null,i.createElement("span",{className:"chatlio-icon-envelope"})),i.createElement("td",null,i.createElement("span",{className:"chatlio-icon-mute"})),i.createElement("td",null,i.createElement("span",{className:"chatlio-icon-cross-circle"}))),i.createElement("tr",null,i.createElement("td",null,"Email"),i.createElement("td",null,"Mute"),i.createElement("td",null,"End Chat")))))),i.createElement(b,{meta:this.props.meta,messages:this.props.messages,widgetViewState:this.props.widgetViewState,sendMessage:this.props.sendMessage,userTyping:this.props.userTyping,isOffline:e,requestScreenshot:this.props.requestScreenshot,onShowOfflineForm:this.props.onShowOfflineForm,requestInfo:this.props.requestInfo}),this.props.meta.whiteLabel?"":i.createElement(d,{isOffline:e})))}}),d=i.createClass({displayName:"PoweredBy",render:function(){var e="chatlio-powered-by";return this.props.isOffline&&(e+=" chatlio-powered-by-offline"),i.createElement("div",{className:"chatlio-clear"},i.createElement("div",{className:e},"Powered by ",i.createElement("a",{target:"_blank",href:"https://chatlio.com"},"Chatlio")))}}),p=i.createClass({displayName:"EnterInfo",getInitialState:function(){return{email:"",name:"",emailError:!1}},sendRequiredInfo:function(){o.setItem(v,!0),window._chatlio.identify(D.userId,{email:this.state.email,name:this.state.name}),this.props.enteredRequiredInfo()},handleChange:function(e){var t=this.state||{};t[e.target.name]=e.target.value,this.isValidInput(t)?t.emailError=!1:t.emailError=!0,this.setState(t)},handleKeyDown:function(e){return this.isValidInput(this.state)&&13===e.keyCode?void this.sendRequiredInfo():void 0},emailRe:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,isValidInput:function(e){return e.hasOwnProperty("email")?""===e.email?!0:this.emailRe.test(e.email):!0},render:function(){return i.createElement("div",{className:"chatlio-widget-body "+this.props.widgetViewState},i.createElement("div",null,i.createElement("div",{className:"chatlio-offline-message-container"},i.createElement("p",{className:"chatlio-missed-you-message"},this.props.meta.requireInfoGreeting),i.createElement("input",{type:"text",name:"email",onKeyDown:this.handleKeyDown,onChange:this.handleChange,className:this.state.emailError?"error":"",placeholder:this.props.meta.offlineEmailPlaceholder}),i.createElement("input",{type:"text",name:"name",onKeyDown:this.handleKeyDown,onChange:this.handleChange,placeholder:this.props.meta.offlineNamePlaceholder}),i.createElement("button",{className:"chatlio-btn",onClick:this.sendRequiredInfo,disabled:this.state.emailError||""===this.state.email},this.props.meta.requireInfoSubmitBtn))))}}),b=i.createClass({displayName:"ChatWidget",requireInfoState:function(e){var t=JSON.parse(o.getItem(v));return{requireInfo:e.requireInfo&&!t}},getInitialState:function(){return this.requireInfoState(this.props.meta)},componentWillReceiveProps:function(e){this.setState(this.requireInfoState(e.meta))},enteredRequiredInfo:function(){setTimeout(function(){this.setState({requireInfo:!1})}.bind(this),500)},render:function(){return this.props.isOffline?i.createElement(q,{meta:this.props.meta,sendMessage:this.props.sendMessage,messages:this.props.messages,widgetViewState:this.props.widgetViewState}):this.state.requireInfo?i.createElement(p,{meta:this.props.meta,enteredRequiredInfo:this.enteredRequiredInfo,widgetViewState:this.props.widgetViewState}):i.createElement(T,{sendMessage:this.props.sendMessage,messages:this.props.messages,widgetViewState:this.props.widgetViewState,userTyping:this.props.userTyping,requestScreenshot:this.props.requestScreenshot,requestInfo:this.props.requestInfo,onShowOfflineForm:this.props.onShowOfflineForm,meta:this.props.meta})}}),E=i.createClass({displayName:"RequestScreenshot",render:function(){return this.props.screenshot?i.createElement("div",{className:"chatlio-inline-dialog chatlio-screenshot-request"},i.createElement("p",null,this.props.text),i.createElement("div",null,i.createElement("button",{onClick:this.props.screenshot.dismiss,className:"chatlio-btn chatlio-btn-dismiss"},this.props.declineLabel),i.createElement("button",{onClick:this.props.screenshot.send,className:"chatlio-btn chatlio-btn-send"},this.props.allowLabel))):null}}),N=i.createClass({displayName:"RequestInfo",handleChange:function(e){var t=this.state||{};t[e.target.name]=e.target.value,this.setState(t)},handleKeyDown:function(e){return 13===e.keyCode?void this.sendRequestInfo():void 0},sendRequestInfo:function(){var e=!1;for(var t in this.state)if(this.state.hasOwnProperty(t)){e=!0;break}e&&(window._chatlio.identify(D.userId,this.state),this.props.requestInfo.send(this.state),setTimeout(function(){this.replaceState({})}.bind(this),0))},titleCaseize:function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()},render:function(){if(!this.props.requestInfo)return null;var e=this;return i.createElement("div",{className:"chatlio-inline-dialog "},this.props.requestInfo.fields.map(function(t){var s=t.toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/-$/,""),a=t.replace(/\w\S*/g,e.titleCaseize);return i.createElement("input",{name:s,placeholder:a,onChange:e.handleChange,onKeyDown:e.handleKeyDown,type:"text"})}),i.createElement("div",null,i.createElement("button",{onClick:this.props.requestInfo.dismiss,className:"chatlio-btn chatlio-btn chatlio-btn-dismiss"},this.props.denyLabel),i.createElement("button",{onClick:this.sendRequestInfo,className:"chatlio-btn chatlio-btn chatlio-btn-send"},this.props.sendLabel)))}}),I=i.createClass({displayName:"MessageInput",getInitialState:function(){return{renderSubmit:!1,submitEnabled:!1}},mq:void 0,mqHandler:function(e){var t=!1;e.matches&&(t=!0),this.setState({renderSubmit:t})},componentDidMount:function(){"matchMedia"in window&&(this.mq=window.matchMedia("(max-width:480px)"),this.mq.matches&&this.mqHandler(this.mq),this.mq.addListener(this.mqHandler))},componentWillUnmount:function(){this.mq&&"matchMedia"in window&&this.mq.removeListener(this.mqHandler)},propTypes:{minRows:i.PropTypes.number.isRequired,maxRows:i.PropTypes.number.isRequired},resizeTextArea:function(){for(var e=this.refs.ta;e.rows>this.props.minRows&&e.scrollHeight<=e.offsetHeight;)e.rows--;if(!(e.rows>=this.props.maxRows))for(var t=0;e.scrollHeight>e.offsetHeight&&t!==e.offsetHeight;)t=e.offsetHeight,e.rows++},handleFocus:function(){this.mq&&this.mq.matches&&!m.embedInline&&(-1!==document.body.className.indexOf(" chatlio-freeze-content")?document.body.className=document.body.className.replace(" chatlio-freeze-content",""):document.body.className=document.body.className+" chatlio-freeze-content")},onChange:function(e){e.target.value.length>0?this.setState({submitEnabled:!0}):this.setState({submitEnabled:!1})},onClick:function(e){this.setState({submitEnabled:!1}),this.props.sendMessage(e)},render:function(){if(this.props.connecting)return i.createElement("div",{className:"chatlio-new-message-container"},i.createElement("textarea",{rows:"1",className:"chatlio-new-message chatlio-connecting",disabled:"true",placeholder:"Connecting to Chatlio. Please wait..."}));var e,t="chatlio-new-message-container",s="chatlio-new-message";if(this.props.whiteLabel===!0&&(t+=" chatlio-white-label"),this.state.renderSubmit){var a="chatlio-btn-send";this.state.submitEnabled||(a+=" chatlio-btn-send-disabled"),e=i.createElement("div",{className:"chatlio-btn-container"},i.createElement("a",{onClick:this.onClick,className:a},this.props.defaultSendBtnLabel)),t="chatlio-new-message-container-small",s="chatlio-new-message-small"}return i.createElement("div",{className:t},i.createElement("textarea",{ref:"ta",rows:this.props.minRows,onKeyDown:this.props.sendMessage,onKeyUp:this.resizeTextArea,onChange:this.onChange,onFocus:this.handleFocus,onBlur:this.handleFocus,className:s,placeholder:this.props.placeholder}),e)}}),T=i.createClass({displayName:"ChatWidgetOnline",render:function(){return i.createElement("div",{className:"chatlio-widget-body "+this.props.widgetViewState},i.createElement(O,{messages:this.props.messages,meta:this.props.meta,requestScreenshot:this.props.requestScreenshot,onShowOfflineForm:this.props.onShowOfflineForm,requestInfo:this.props.requestInfo,userTyping:this.props.userTyping}),i.createElement(I,{minRows:1,maxRows:5,whiteLabel:this.props.meta.whiteLabel,connecting:this.props.meta.connecting,defaultSendBtnLabel:this.props.meta.defaultSendBtnLabel,sendMessage:this.props.sendMessage,placeholder:this.props.meta.onlineMessagePlaceholder}))}}),q=i.createClass({displayName:"ChatWidgetOffline",getInitialState:function(){return{email:D.traits.email||"",name:D.traits.name||"",message:""}},componentWillReceiveProps:function(){this.setState(this.getInitialState())},handleChange:function(e){var t={};t[e.target.name]=e.target.value,this.state.email.length>0&&this.setState({emailError:!1}),this.state.message.length>0&&this.setState({messageError:!1}),this.setState(t)},sendOfflineMsg:function(){this.setState({
emailError:!1,messageError:!1}),this.state.email.length<1&&this.setState({emailError:!0}),this.state.message.length<1&&this.setState({messageError:!0}),this.state.email.length<1||this.state.message.length<1||(this.setState({offlineMessageSent:!0}),Ne([this.state.name,this.state.email,this.state.message].join("\n"),!0))},render:function(){return i.createElement("div",{className:"chatlio-widget-body "+this.props.widgetViewState},i.createElement("div",null,this.state.offlineMessageSent?i.createElement("div",{className:"chatlio-offline-message-container-sent"},i.createElement("div",null,this.props.meta.offlineThankYouMessage)):i.createElement("div",{className:"chatlio-offline-message-container"},i.createElement("p",{className:"chatlio-missed-you-message"},this.props.meta.offlineGreeting),i.createElement("input",{name:"email",value:this.state.email,type:"text",onChange:this.handleChange,className:this.state.emailError?"error":"",placeholder:this.props.meta.offlineEmailPlaceholder}),i.createElement("textarea",{name:"message",className:this.state.messageError?"error":"",rows:"3",onChange:this.handleChange,placeholder:this.props.meta.offlineMessagePlaceholder}),i.createElement("input",{name:"name",type:"text",value:this.state.name,onChange:this.handleChange,placeholder:this.props.meta.offlineNamePlaceholder}),i.createElement("button",{className:"chatlio-btn",onClick:this.sendOfflineMsg},this.props.meta.offlineSendButton))))}}),O=i.createClass({displayName:"ChatMessages",scrollToBottom:function(){var e=n.findDOMNode(this);e.scrollTop=e.scrollHeight},mediaquery:void 0,componentDidMount:function(){this.scrollToBottom(),"matchMedia"in window&&(this.mediaquery=window.matchMedia("(max-width:480px)"),this.mediaquery.addListener(this.scrollToBottom))},componentDidUpdate:function(){this.scrollToBottom()},componentWillUnmount:function(){this.mediaquery&&"matchMedia"in window&&this.mediaquery.removeListener(this.scrollToBottom)},headerMsg:function(){return{body:this.props.meta.autoResponseMessage,author:this.props.meta.agentLabel}},render:function(){var e,t=this,s=!0,a=!1;this.props.messages.length>0&&(s="You"===this.props.messages[this.props.messages.length-1].author);var n=this.props.meta.forwardSlackUserName,o="chatlio-message-container";return this.props.meta.whiteLabel&&(o+=" chatlio-white-label"),i.createElement("div",{id:"chatlio-message-container",className:o},i.createElement("div",{className:"chatlio-message-scrollable"},i.createElement("span",null,i.createElement(_,{showSlackAvatar:n,msg:this.headerMsg(),needAvatar:!0,threadEnd:!1})),this.props.messages.map(function(s,o){if(e=!0,a=!1,o>0){var r=t.props.messages[o-1];r.author===s.author&&(e=!1),t.props.messages[o+1]&&t.props.messages[o+1].author!==t.props.messages[o].author&&(a=!0)}return s.attachedFile?i.createElement(P,{showSlackAvatar:n,attachedFile:s.attachedFile,needAvatar:e,msg:s,browserSideAuthorLabel:t.props.meta.browserSideAuthorLabel,key:o}):i.createElement(_,{showSlackAvatar:n,msg:s,needAvatar:e,threadEnd:a,browserSideAuthorLabel:t.props.meta.browserSideAuthorLabel,key:o})}),i.createElement(A,{userTyping:this.props.userTyping,needAvatar:s,showSlackAvatar:n,msg:this.headerMsg()}),i.createElement(E,{screenshot:this.props.requestScreenshot,text:this.props.meta.requestScreenshotText,allowLabel:this.props.meta.requestScreenshotAllowLabel,declineLabel:this.props.meta.requestScreenshotDeclineLabel}),i.createElement(N,{requestInfo:this.props.requestInfo,sendLabel:this.props.meta.defaultSendBtnLabel,denyLabel:this.props.meta.defaultCancelBtnLabel})))}}),A=i.createClass({displayName:"TypingIndicator",render:function(){if(!this.props.userTyping)return null;var e,t=this.props.msg.author;return this.props.userTyping.avatarUrl&&this.props.userTyping.avatarUrl.length>5&&this.props.showSlackAvatar?e=i.createElement("img",{src:this.props.userTyping.avatarUrl}):"You"!==t&&(e=i.createElement("img",{src:a})),this.props.needAvatar?i.createElement("div",{className:"chatlio-message chatlio-clear"},i.createElement("div",{className:"chatlio-message-header"},i.createElement("div",{className:"chatlio-message-avatar"},e),i.createElement("div",{className:"typing-indicator chatlio-clear"},i.createElement("span",null),i.createElement("span",null),i.createElement("span",null)))):i.createElement("div",{className:"chatlio-message chatlio-clear"},i.createElement("div",{className:"chatlio-message-content"},i.createElement("div",{className:"typing-indicator"},i.createElement("span",null),i.createElement("span",null),i.createElement("span",null))))}}),U=i.createClass({displayName:"ChatMessageHeader",render:function(){var e,t=this.props.msg.author;return this.props.msg&&this.props.msg.avatarUrl&&this.props.msg.avatarUrl.length>5&&this.props.showSlackAvatar?e=i.createElement("img",{src:this.props.msg.avatarUrl}):"You"!==t&&(e=i.createElement("img",{src:a})),i.createElement("div",{className:"chatlio-message-header"},i.createElement("div",{className:"chatlio-message-avatar"},e))}}),_=i.createClass({displayName:"ChatMessage",render:function(){var e=this.props.msg.body||"";window.emojione&&(window.emojione.ascii=!0,e=window.emojione.shortnameToImage(e));var t=1e3*this.props.msg.ts>Date.now()-500,a="chatlio-message chatlio-message-";a+="You"===this.props.msg.author?"from-me":"from-them";var n="chatlio-message-content";return e.indexOf("<pre>")>-1?(e=e.replace(/<br\/>/gm,""),n+=" chatlio-message-content-code"):e=e.replace(/\n/gm,"\n<br/>"),i.createElement("div",{key:this.props.key,className:a},this.props.needAvatar?i.createElement(U,{showSlackAvatar:this.props.showSlackAvatar,msg:this.props.msg,browserSideAuthorLabel:this.props.browserSideAuthorLabel}):"",i.createElement("div",{className:n},i.createElement(s,{transitionName:"chatlio-fade-in-message-body",transitionAppear:t,transitionEnterTimeout:5e3,transitionLeaveTimeout:5e3,transitionAppearTimeout:5e3},this.props.msg.bodyComponent?i.createElement("span",{className:"chatlio-message-body"},this.props.msg.bodyComponent):i.createElement("span",{className:"chatlio-message-body",dangerouslySetInnerHTML:{__html:e}}))),this.props.threadEnd?i.createElement("div",{className:"chatlio-message-timestamp"},Y(1e3*this.props.msg.ts)):"")}}),P=i.createClass({displayName:"AttachedFile",render:function(){var e=this.props.attachedFile.thumb360?i.createElement("img",{className:"chatlio-file-attachment",src:this.props.attachedFile.thumb360}):"";return i.createElement("div",{className:"chatlio-message chatlio-message-from-them chatlio-clear"},this.props.needAvatar?i.createElement(U,{showSlackAvatar:this.props.showSlackAvatar,msg:this.props.msg,browserSideAuthorLabel:this.props.browserSideAuthorLabel}):"",i.createElement("div",{className:"chatlio-message-content"},i.createElement("a",{href:this.props.attachedFile.url,target:"_blank"},e,i.createElement("div",{className:"chatlio-clear"}),i.createElement("div",{className:"chatlio-file-attachment-title"},this.props.attachedFile.title))))}});be=function(e){n.render(i.createElement(r,{meta:e}),y)},u=!f,Ie(e,!0),C=setTimeout(qe,x),xe()}}();